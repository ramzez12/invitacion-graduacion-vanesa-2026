<!-- REPRODUCTOR DE MÃšSICA MINIMALISTA -->
<div
  class="w-full max-w-[280px] mx-auto sm:mt-16 pb-10"
  id="music-player-container"
>
  <!-- Texto informativo -->
  <p class=" font-charm text-sm text-center text-[#7A8980] mb-4 font-medium">
    Presiona para escuchar
  </p>

  <!-- LÃ­nea superior -->
  <div class="w-full h-0.5 bg-[#7A8980] mb-4"></div>

  <!-- Controles principales -->
  <div
    class="flex items-center justify-center space-x-6"
    id="controls-container"
  >
    <!-- BotÃ³n anterior -->
    <button
      id="prevBtn"
      class="text-[#7A8980] hover:text-[#7A8980]/70 transition-all duration-300 transform hover:scale-110 focus:outline-none"
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"></path>
      </svg>
    </button>

    <!-- BotÃ³n principal play -->
    <button
      id="playPauseBtn"
      class="relative text-[#7A8980] transition-all duration-300 transform hover:scale-110 focus:outline-none w-12 h-12 flex items-center justify-center rounded-full border-2 border-[#7A8980] bg-white"
    >
      <svg
        id="play-icon"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="currentColor"
      >
        <path d="M8 5v14l11-7z"></path>
      </svg>
      <svg
        id="pause-icon"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="hidden"
      >
        <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"></path>
      </svg>
    </button>

    <!-- BotÃ³n siguiente -->
    <button
      id="nextBtn"
      class="text-[#7A8980] hover:text-[#7A8980]/70 transition-all duration-300 transform hover:scale-110 focus:outline-none"
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"></path>
      </svg>
    </button>
  </div>
</div>

<!-- Audio element -->
<audio id="music-audio" preload="auto">
  <source src="/audio/loscapos.mp3" type="audio/mpeg" />
  Tu navegador no soporta audio HTML5.
</audio>

<!-- SCRIPTS CON TIMING INTELIGENTE -->
<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  let isPlaying = false;
  let currentTime = 0;
  let duration = 0;

  document.addEventListener("DOMContentLoaded", () => {
    console.log("ðŸŽµ Iniciando reproductor minimalista...");

    // Configurar estado inicial (invisible)
    gsap.set("#music-player-container", {
      opacity: 0,
      y: 30,
    });

    // ðŸŽ¯ SCROLLTRIGGER - Solo aparece una vez
    ScrollTrigger.create({
      trigger: "#music-player-container",
      start: "top 100%",
      once: true,

      onEnter: () => {
        console.log('ðŸŽµ âœ¨ Reproductor apareciendo...');
        gsap.to("#music-player-container", {
          opacity: 1,
          y: 0,
          duration: 0.6,
          ease: "power2.out",
        });
      },
    });

    // EVENT LISTENERS
    const playPauseBtn = document.getElementById("playPauseBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    if (playPauseBtn) {
      playPauseBtn.addEventListener("click", togglePlayPause);
    }

    if (prevBtn) {
      prevBtn.addEventListener("click", previousTrack);
    }

    if (nextBtn) {
      nextBtn.addEventListener("click", nextTrack);
    }

    // OBTENER DURACIÃ“N REAL DEL AUDIO
    const audioElement = document.getElementById("music-audio");
    if (audioElement instanceof HTMLAudioElement) {
      audioElement.addEventListener("loadedmetadata", () => {
        duration = audioElement.duration;
      });
    }
  });

  // FUNCIÃ“N PLAY/PAUSE
  function togglePlayPause() {
    const audioElement = document.getElementById("music-audio");
    const playIcon = document.getElementById("play-icon");
    const pauseIcon = document.getElementById("pause-icon");
    const playBtn = document.getElementById("playPauseBtn");

    if (!(audioElement instanceof HTMLAudioElement)) {
      console.log("No se encontrÃ³ el elemento de audio");
      return;
    }

    const audio = audioElement;

    if (!isPlaying) {
      audio.play().catch((error) => console.log("Error al reproducir:", error));

      if (playIcon) playIcon.classList.add("hidden");
      if (pauseIcon) pauseIcon.classList.remove("hidden");

      gsap.to(playBtn, {
        scale: 1.15,
        duration: 0.2,
        yoyo: true,
        repeat: 1,
        ease: "power2.out",
      });

      isPlaying = true;
      startProgress();
    } else {
      audio.pause();

      if (playIcon) playIcon.classList.remove("hidden");
      if (pauseIcon) pauseIcon.classList.add("hidden");

      isPlaying = false;
    }
  }

  // FUNCIONES ADICIONALES
  function previousTrack() {
    console.log("CanciÃ³n anterior");
    const audioElement = document.getElementById("music-audio");
    if (audioElement) {
      audioElement.currentTime = 0;
    }
  }

  function nextTrack() {
    console.log("Siguiente canciÃ³n");
  }

  function startProgress() {
    const audioElement = document.getElementById("music-audio");

    if (!(audioElement instanceof HTMLAudioElement)) return;

    const interval = setInterval(() => {
      if (!isPlaying) {
        clearInterval(interval);
        return;
      }

      currentTime = audioElement.currentTime;
      duration = audioElement.duration || duration;

      if (currentTime >= duration) {
        isPlaying = false;
        const playIcon = document.getElementById("play-icon");
        const pauseIcon = document.getElementById("pause-icon");
        if (playIcon) playIcon.classList.remove("hidden");
        if (pauseIcon) pauseIcon.classList.add("hidden");
        clearInterval(interval);
      }
    }, 100);
  }
</script>

<style>
  button:hover {
    transform: translateY(-2px) scale(1.1);
  }
</style>